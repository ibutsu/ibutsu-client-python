"""
Ibutsu API

A system to store and query test results

The version of the OpenAPI document: 2.8.3
Generated by OpenAPI Generator (https://openapi-generator.tech)

Do not edit the class manually.
"""

import json
from uuid import uuid4

from ibutsu_client.models.token import Token


class TestToken:
    """Token model tests"""

    def test_token_creation_empty(self):
        """Test Token creation with no parameters - fail as required fields exist"""
        # Token requires id, user_id, name, token.
        # But Pydantic init usually allows missing if validated later?
        # However, defaults are NOT set for these fields in the model definition provided earlier.
        # id: UUID = Field(...)
        # So init without them might raise ValidationError if strict,
        # but Pydantic V2 usually requires them if no default.
        # Let's try initializing with required fields.

    def test_token_creation_required(self):
        """Test Token creation with required parameters"""
        uid = uuid4()
        user_id = uuid4()
        token = Token(id=uid, user_id=user_id, name="mytoken", token="abc")

        assert token.id == uid
        assert token.name == "mytoken"

    def test_token_creation_full(self):
        """Test Token creation with all parameters"""
        uid = uuid4()
        user_id = uuid4()

        token = Token(id=uid, user_id=user_id, name="fulltoken", expires="2023-12-31", token="xyz")

        assert token.id == uid
        assert token.expires == "2023-12-31"

    def test_token_to_dict(self):
        """Test Token to_dict conversion"""
        uid = uuid4()
        user_id = uuid4()
        token = Token(id=uid, user_id=user_id, name="dicttoken", token="abc")
        token_dict = token.to_dict()

        assert isinstance(token_dict, dict)
        assert token_dict["name"] == "dicttoken"

    def test_token_to_json(self):
        """Test Token to_json conversion"""
        uid = uuid4()
        user_id = uuid4()
        token = Token(id=uid, user_id=user_id, name="jsontoken", token="abc")
        token_json = token.to_json()

        assert isinstance(token_json, str)
        parsed = json.loads(token_json)
        assert parsed["name"] == "jsontoken"

    def test_token_from_dict(self):
        """Test Token from_dict creation"""
        uid = str(uuid4())
        user_id = str(uuid4())
        token_dict = {"id": uid, "user_id": user_id, "name": "from_dict", "token": "abc"}
        token = Token.from_dict(token_dict)

        assert isinstance(token, Token)
        assert str(token.id) == uid
        assert token.name == "from_dict"

    def test_token_from_json(self):
        """Test Token from_json creation"""
        uid = str(uuid4())
        user_id = str(uuid4())
        # Construct JSON manually
        token_json = json.dumps(
            {"id": uid, "user_id": user_id, "name": "from_json", "token": "abc"}
        )
        token = Token.from_json(token_json)

        assert isinstance(token, Token)
        assert token.name == "from_json"

    def test_token_to_str(self):
        """Test Token to_str representation"""
        uid = uuid4()
        user_id = uuid4()
        token = Token(id=uid, user_id=user_id, name="strtoken", token="abc")
        token_str = token.to_str()

        assert isinstance(token_str, str)
        assert "strtoken" in token_str

    def test_token_none_values_excluded(self):
        """Test that None values are excluded from dict"""
        uid = uuid4()
        user_id = uuid4()
        token = Token(id=uid, user_id=user_id, name="nonetoken", token="abc")
        token_dict = token.to_dict()

        assert "name" in token_dict
        assert "expires" not in token_dict

    def test_token_explicit_nones(self):
        """Test explicit None values are preserved in to_dict if set"""
        uid = uuid4()
        user_id = uuid4()
        token = Token(id=uid, user_id=user_id, name="explicitnone", token="abc", expires=None)
        token_dict = token.to_dict()

        assert "expires" in token_dict
        assert token_dict["expires"] is None

    def test_token_from_dict_none(self):
        """Test Token.from_dict with None returns None"""
        token = Token.from_dict(None)
        assert token is None

    def test_token_from_dict_non_dict(self):
        """Test from_dict with a non-dict object"""
        uid = uuid4()
        user_id = uuid4()
        token_obj = Token(id=uid, user_id=user_id, name="test_obj", token="abc")
        new_token = Token.from_dict(token_obj)
        assert new_token.name == "test_obj"

    def test_token_roundtrip_json(self):
        """Test Token can be serialized and deserialized"""
        uid = uuid4()
        user_id = uuid4()
        original = Token(id=uid, user_id=user_id, name="roundtrip", token="abc")
        json_str = original.to_json()
        restored = Token.from_json(json_str)

        assert restored.name == original.name
        assert restored.id == original.id
